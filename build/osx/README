The recommended way to build Gimp for Mac OS X is using jhbuild, configured with a base module set maintained in gtk-osx.

General documentation on building GTK+ for OS X:
https://wiki.gnome.org/Projects/GTK+/OSX/Building


Environment:

Beware that MacPorts, Homebrew etc may interfere with the jhbuild environment. Keep these out of your shell environment when building with jhbuild.

Also avoid having directories with spaces in your PATH; this can cause build failures in some modules.


First steps:

  $ curl -O https://git.gnome.org/browse/gtk-osx/plain/gtk-osx-build-setup.sh
  $ sh gtk-osx-build-setup.sh

This will fetch the current version of jhbuild with the gtk-osx module sets, installing jhbuild into ~/.local/ -- so make sure ~/.local/bin is in your PATH for later.

If using the 10.9 SDK, note that Apple has dropped python from the SDK copy of the libraries as they now discourage linking against the system python. You'll have to enable a local python build; edit .jhbuildrc-custom and add:

  _gtk_osx_use_jhbuild_python = True

To build the master branch of gimp and its dependencies, enable the unstable module sets. Add to .jhbuildrc-custom:

  moduleset = 'http://git.gnome.org/browse/gtk-osx/plain/modulesets-unstable/gtk-osx.modules'


Now, bootstrap the main GTK+ libraries...

  $ jhbuild bootstrap
  $ jhbuild build python2.7 # explicit since it's not in the deps
  $ jhbuild build meta-gtk-osx-bootstrap

Because there's currently a circular dependency between harfbuzz and freetype <https://bugzilla.freedesktop.org/show_bug.cgi?id=75652> you'll have to temporarily jump through some hoops to build a few packages. Edit ~/.jhbuildrc-custom and add this line:

  append_autogenargs('freetype', '--without-harfbuzz')

Now, let's build freetype:

  $ jhbuild build freetype

Now for a fun part. Edit ~/gtk/inst/lib/pkgconfig/freetype2.pc and remove the 'harfbuzz >= 0.9.19' from this line:

  Requires.private: libpng, harfbuzz >= 0.9.19

Now, we can build fontconfig and harfbuzz:

  $ jhbuild build harfbuzz

Now edit ~/.jhbuildrc-custom again and REMOVE that line from above... Got it? Great! Now we can rebuild freetype with its harfbuzz support enabled:

  $ jhbuild buildone --force --distclean freetype




Now let's get to the main event!

  $ jhbuild build gimp


^ this will probably fail somewhere, haven't got that far yet



# sighhhhhh trying on 'stable'

Babl fails to build with clang on 10.9 <https://bugzilla.gnome.org/show_bug.cgi?id=725530>. Workaround: add to .jhbuildrc-custom:

  append_autogenargs('babl', '--disable-sse')

We also need a patch for gimp <https://bugzilla.gnome.org/show_bug.cgi?id=725531>, hopefully this will merge soon.

Now let's build...

  $ jhbuild bootstrap
  $ jhbuild build python # explicit since it's not in the deps
  $ jhbuild build meta-gtk-osx-bootstrap
  $ jhbuild build meta-gtk-osx-freetype
  $ jhbuild build meta-gtk-osx-core
  $ jhbuild build gimp
	
What's that, it worked! Launch it!

  $ jhbuild run gimp

Neat!



# Ok now with our customized module sets

  $ cp jhbuildrc-gimp ~/.jhbuildrc-gimp
  $ mkdir ~/gimp/directory && cp gimp.modules ~/gimp/directory/gimp.modules
  $ JHB=gimp jhbuild bootstrap
  $ JHB=gimp jhbuild build python # explicit since it's not in the deps
  $ JHB=gimp jhbuild build meta-gtk-osx-bootstrap
  $ JHB=gimp jhbuild build meta-gtk-osx-freetype
  $ JHB=gimp jhbuild build meta-gtk-osx-core
  $ JHB=gimp jhbuild build gimp

and run it!

  $ JHB=gimp jhbuild run gimp-2.9


Bundling:

[need to figure out the app bundling]
